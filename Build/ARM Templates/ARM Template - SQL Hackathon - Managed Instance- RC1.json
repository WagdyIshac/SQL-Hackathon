{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.1",
    "parameters": {
        "managedInstanceName": {
            "defaultValue": "sqlhackmi",
            "type": "string",
            "maxLength": 13,
            "metadata": {
                "description": "Enter name to assign to the Azure SQL Database Managed Instance. The name can contain only lowercase letters, numbers, and '-', but can't start or end with '-' or have more than 63 characters."
            }
        },
        "adminUsername": {
            "defaultValue": "DemoUser",
            "type": "string",
            "metadata": {
                "description": "Administrator user name for logging into the virtual machine and SQL MI."
            }
        },
        "adminPassword": {
            "defaultValue": "Demo@pass1234567",
            "type": "securestring",
            "minLength": 16,
            "maxLength": 128,
            "metadata": {
                "description": "The password must be between 16 and 128 characters in length and must contain at least one number, one non-alphanumeric character, and one upper or lower case letter. Default value is Password.1234567890"
            }
        },
        "vCores": {
            "type": "int",
            "defaultValue": 4,
            "allowedValues": [
                4,
                8,
                16,
                24,
                32,
                40,
                64,
                80
            ],
            "metadata": {
                "description": "Select the number of vCores for SQL Managed Instance used as the Detination."
            }
        },
        "storageSizeInGB": {
            "type": "int",
            "defaultValue": 32,
            "allowedValues": [
                32,
                64,
                96,
                128,
                160,
                192,
                224,
                256
            ],
            "metadata": {
                "description": "Select the storage size for the Managed Instance."
            }
        }
        
    },
    "variables": {
        "location": "[resourceGroup().location]",
        "uniqueManagedInstanceName": "[concat(parameters('managedInstanceName'), '-', uniqueString(resourceGroup().id))]",
        "skuName": "GP_Gen5",
        "skuEdition": "GeneralPurpose",
        "licenseType": "BasePrice",
        "hardwareFamily": "Gen5",
        "publicDataEndpointEnabled": false,
        "timezoneId": "UTC",
        "virtualNetworkName": "[concat(resourceGroup().name, '-vnet')]",
        "MIsubnetName": "ManagedInstance"

    },
    "resources": [
        {
            "type": "Microsoft.Sql/managedInstances",
            "apiVersion": "2018-06-01-preview",
            "dependsOn": [
            ],
            "identity": {
                "type": "SystemAssigned"
            },
            "location": "[variables('location')]",
            "name": "[variables('uniqueManagedInstanceName')]",
            "sku": {
                "name": "[variables('skuName')]",
                "tier": "[variables('skuEdition')]"
            },
            "properties": {
                "administratorLogin": "[parameters('adminUsername')]",
                "administratorLoginPassword": "[parameters('adminPassword')]",
                "subnetId": "[resourceId('Microsoft.Network/virtualNetworks/subnets', variables('virtualNetworkName'), variables('MIsubnetName'))]",
                "storageSizeInGB": "[parameters('storageSizeInGB')]",
                "vCores": "[parameters('vCores')]",
                "licenseType": "[variables('licenseType')]",
                "hardwareFamily": "[variables('hardwareFamily')]",
                "dnsZonePartner": "",
                "collation": "SQL_Latin1_General_CP1_CI_AS",
                "proxyOverride": "",
                "publicDataEndpointEnabled": "[variables('publicDataEndpointEnabled')]",
                "timezoneId": "[variables('timezoneId')]"
            }
        } 
    ]
}